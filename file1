<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieFinder</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #141414;
            --text: white;
            --accent: #e50914;
            --card: #222;
        }
        .light-mode {
            --bg: #f5f5f5;
            --text: #141414;
            --accent: #b9090b;
            --card: #ffffff;
        }

        body { margin: 0; font-family: Arial, sans-serif; background: var(--bg); color: var(--text); transition: 0.3s; }

        /* ===== LOGIN (RESTORED) ===== */
        .login-page {
            position: fixed; inset: 0; background: linear-gradient(135deg,#141e30,#243b55);
            display: flex; align-items: center; justify-content: center; z-index: 5000;
        }
        .login-card {
            background: rgba(255,255,255,0.15); backdrop-filter: blur(15px);
            padding: 40px; border-radius: 20px; width: 360px; text-align: center;
        }
        .login-card input { width: 100%; padding: 14px; margin: 10px -14px; border-radius: 30px; border: none; }
        .login-card button { 
            width: 100%; padding: 14px; border-radius: 30px; border: none; 
            background: #e50914; color: white; font-weight: bold; cursor: pointer;
        }

        /* ===== HEADER & NAV ===== */
        .header {
            position: fixed; top: 0; width: 100%; background: rgba(0,0,0,0.9);
            padding: 15px 30px; display: flex; justify-content: space-between;
            align-items: center; z-index: 1000; box-sizing: border-box;
        }
        .nav-link {
            background: none; border: none; color: white; margin-left: 15px;
            cursor: pointer; font-size: 16px; opacity: 0.6; padding-bottom: 5px;
        }
        .nav-link.active { opacity: 1; border-bottom: 2px solid var(--accent); color: var(--accent); }

        /* ===== HERO CAROUSEL ===== */
        .hero { height: 75vh; background-size: cover; background-position: center; position: relative; transition: 0.8s; margin-top: 0; }
        .hero::after { content: ""; position: absolute; inset: 0; background: linear-gradient(to top, var(--bg), transparent); }
        .hero-content { position: absolute; bottom: 80px; left: 40px; max-width: 500px; z-index: 5; }

        /* ===== SEARCH (IN HOME) ===== */
        .search-box { margin: -30px auto 30px; position: relative; z-index: 10; max-width: 600px; display: flex; padding: 0 20px; }
        .search-box input { flex: 1; padding: 15px 25px; border-radius: 30px 0 0 30px; border: none; background: var(--card); color: var(--text); box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .search-box button { padding: 15px 30px; border-radius: 0 30px 30px 0; border: none; background: var(--accent); color: white; cursor: pointer; }

        /* ===== MOVIE ROWS ===== */
        .section { margin: 40px 0; }
        .section h2 { margin-left: 40px; }
        .row { display: flex; overflow-x: auto; gap: 15px; padding: 20px 40px; }
        .row::-webkit-scrollbar { display: none; }
        .row-card { min-width: 180px; height: 270px; border-radius: 10px; cursor: pointer; transition: 0.3s; position: relative; }
        .row-card img { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; }
        .row-card:hover { transform: scale(1.1); z-index: 2; }

        /* ===== FAVORITES PAGE ===== */
        .fav-container { padding: 100px 40px; display: none; }
        .empty-fav-msg { text-align: center; padding: 50px; background: var(--card); border-radius: 20px; margin-bottom: 40px; }
        .rec-gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .rec-item { background: var(--card); border-radius: 15px; overflow: hidden; border-bottom: 4px solid var(--accent); }
        .rec-item img { width: 100%; height: 150px; object-fit: cover; }

        /* ===== SEARCH GRID ===== */
        .movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 25px; padding: 20px 40px; }
        .movie-card { background: var(--card); border-radius: 10px; overflow: hidden; padding-bottom: 10px; }
        .movie-card img { width: 100%; height: 280px; object-fit: cover; }
        .movie-meta { padding: 10px; display: flex; justify-content: space-between; font-size: 13px; }
        .star { color: #f1c40f; }

        /* ===== FOOTER ===== */
        footer { padding: 40px; text-align: center; background: rgba(0,0,0,0.2); border-top: 1px solid #333; margin-top: 50px; }
    </style>
</head>
<body>

<div id="loginPage" class="login-page">
    <div class="login-card">
        <h2>ðŸŽ¬ Movie-Xplorer</h2>
        <input id="loginUser" placeholder="Username">
        <input id="loginPass" type="password" placeholder="Password">
        <button onclick="handleLogin()">Login</button>
    </div>
</div>

<div class="header">
    <div style="font-weight:bold; font-size:20px;">ðŸŽ¬ MovieFinder <span id="userTag" style="color:var(--accent)"></span></div>
    <div>
        <button onclick="toggleTheme()" class="nav-link" style="opacity:1"><i class="fas fa-adjust"></i></button>
        <button id="navHome" onclick="showPage('home')" class="nav-link active">Home</button>
        <button id="navFav" onclick="showPage('fav')" class="nav-link">Favorites</button>
        <button onclick="handleLogout()" class="nav-link"><i class="fas fa-sign-out-alt"></i></button>
    </div>
</div>

<div id="homeWrapper">
    <div id="hero" class="hero"></div>

    <div class="search-box">
        <input id="searchIn" placeholder="What are you looking for?" onkeypress="if(event.key==='Enter') search()">
        <button onclick="search()">Search</button>
    </div>

    <div id="homeRows"></div>
    <div id="searchResult" class="movie-grid" style="display:none;"></div>
</div>

<div id="favWrapper" class="fav-container">
    <div id="favList"></div>
    <div id="recommendationSection">
        <h2 id="favTitle">Recommended for You</h2>
        <div id="recList" class="rec-gallery"></div>
    </div>
</div>

<footer>
    <p>Watching as <strong id="footName">Guest</strong></p>
    <p>Â© 2026 MovieFinder â€¢ Premium Member</p>
</footer>

<script>
const API_KEY="94c5595a7db3292dbc0890ef321ded5e";
const BASE="https://api.themoviedb.org/3";
const IMG="https://image.tmdb.org/t/p/w500";
const BIG_IMG="https://image.tmdb.org/t/p/original";

let favorites = JSON.parse(localStorage.getItem("mf_favs")) || [];
let heroList = [];
let hIdx = 0;

/* --- AUTH --- */
function handleLogin() {
    const u = document.getElementById("loginUser").value;
    if(!u) return;
    localStorage.setItem("mf_curr_user", u);
    startApp(u);
}
function handleLogout() { localStorage.clear(); location.reload(); }
function startApp(u) {
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("userTag").innerText = " | Hi, " + u;
    document.getElementById("footName").innerText = u;
    loadHomeData();
}
window.onload = () => {
    const saved = localStorage.getItem("mf_curr_user");
    if(saved) startApp(saved);
}

/* --- NAVIGATION --- */
function showPage(page) {
    document.getElementById("homeWrapper").style.display = page === 'home' ? 'block' : 'none';
    document.getElementById("favWrapper").style.display = page === 'fav' ? 'block' : 'none';
    document.getElementById("navHome").classList.toggle("active", page === 'home');
    document.getElementById("navFav").classList.toggle("active", page === 'fav');
    if(page === 'fav') loadFavorites();
}

function toggleTheme() { document.body.classList.toggle("light-mode"); }

/* --- HOME & SEARCH --- */
async function loadHomeData() {
    const trend = await fetch(`${BASE}/trending/movie/week?api_key=${API_KEY}`).then(r=>r.json());
    const pop = await fetch(`${BASE}/movie/popular?api_key=${API_KEY}`).then(r=>r.json());
    
    heroList = trend.results.slice(0, 5);
    updateHero();
    setInterval(() => { hIdx = (hIdx+1)%5; updateHero(); }, 5000);

    document.getElementById("homeRows").innerHTML = `
        ${drawRow("Trending Now", trend.results)}
        ${drawRow("Most Popular", pop.results)}
    `;
}

function updateHero() {
    const m = heroList[hIdx];
    const hero = document.getElementById("hero");
    hero.style.backgroundImage = `url(${BIG_IMG}${m.backdrop_path})`;
    hero.innerHTML = `
        <div class="hero-content">
            <h1>${m.title}</h1>
            <p>${m.overview.slice(0,150)}...</p>
            <div style="color:#f1c40f">â˜… ${m.vote_average} | ${m.release_date.split('-')[0]}</div>
        </div>`;
}

function drawRow(title, list) {
    return `<div class="section">
        <h2>${title}</h2>
        <div class="row">
            ${list.map(m => `
                <div class="row-card" onclick="addFav(${m.id}, '${m.title.replace(/'/g,"")}', '${m.poster_path}', ${m.vote_average}, '${m.release_date}')">
                    <img src="${IMG}${m.poster_path}">
                </div>`).join('')}
        </div>
    </div>`;
}

async function search() {
    const q = document.getElementById("searchIn").value;
    if(!q) {
        document.getElementById("homeRows").style.display = "block";
        document.getElementById("searchResult").style.display = "none";
        return;
    }
    const res = await fetch(`${BASE}/search/movie?api_key=${API_KEY}&query=${q}`).then(r=>r.json());
    document.getElementById("homeRows").style.display = "none";
    const grid = document.getElementById("searchResult");
    grid.style.display = "grid";
    grid.innerHTML = res.results.map(m => `
        <div class="movie-card">
            <img src="${IMG}${m.poster_path}">
            <div class="movie-meta">
                <strong>${m.title}</strong>
                <i class="fas fa-heart" onclick="addFav(${m.id}, '${m.title.replace(/'/g,"")}', '${m.poster_path}', ${m.vote_average}, '${m.release_date}')" style="cursor:pointer; color:${isFav(m.id)?'#e50914':'#444'}"></i>
            </div>
        </div>
    `).join('');
}

/* --- FAVORITES --- */
function isFav(id) { return favorites.some(f => f.id === id); }

function addFav(id, title, path, vote, date) {
    const idx = favorites.findIndex(f => f.id === id);
    if(idx > -1) favorites.splice(idx, 1);
    else favorites.push({id, title, path, vote, date});
    localStorage.setItem("mf_favs", JSON.stringify(favorites));
    alert(idx > -1 ? "Removed from list" : "Saved to favorites!");
    if(document.getElementById("favWrapper").style.display === "block") loadFavorites();
}

async function loadFavorites() {
    const list = document.getElementById("favList");
    const rec = document.getElementById("recList");
    
    if(favorites.length === 0) {
        list.innerHTML = `
            <div class="empty-fav-msg">
                <i class="fas fa-heart-broken" style="font-size:3rem; color:#444;"></i>
                <h2>No Favorites Yet</h2>
                <p>Start adding movies from the home page to see them here!</p>
            </div>`;
    } else {
        list.innerHTML = `<h2>Your Movies</h2><div class="movie-grid">
            ${favorites.map(m => `
                <div class="movie-card" style="border: 1px solid var(--accent)">
                    <img src="${IMG}${m.path}">
                    <div class="movie-meta">
                        <strong>${m.title}</strong>
                        <span onclick="addFav(${m.id})" style="color:red; cursor:pointer">Remove</span>
                    </div>
                </div>`).join('')}
        </div><hr style="opacity:0.1; margin:40px 0;">`;
    }

    // Recommendations for Favorites Page
    const up = await fetch(`${BASE}/movie/upcoming?api_key=${API_KEY}`).then(r=>r.json());
    rec.innerHTML = up.results.slice(0, 6).map(m => `
        <div class="rec-item">
            <img src="${BIG_IMG}${m.backdrop_path}">
            <div style="padding:15px; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-weight:bold">${m.title}</div>
                    <div class="star">â˜… ${m.vote_average}</div>
                </div>
                <button onclick="addFav(${m.id}, '${m.title.replace(/'/g,"")}', '${m.poster_path}', ${m.vote_average}, '${m.release_date}')" style="background:var(--accent); border:none; color:white; padding:5px 10px; border-radius:5px; cursor:pointer">Add</button>
            </div>
        </div>
    `).join('');
}
</script>

</body>
</html>
